{% extends "base.twig" %}

{% block title %}{{ comment.comment|length > 16 ? comment.comment|slice(0, 16) ~ '…' : comment.comment }}{% endblock %}
{% block contents %}
    {% if comment %}
        <div class="row">
            <article class="comments column">
                <section class="comment js-comment comment_top" id="top" data-comment="{{- comment.comment | trim }}">
                    <header class="comment__header">
                        {% set isSigned = comment.user_name and comment.user_image_url %}
                        <div>
                            <div class="comment__header__wrap">
                                {% if isSigned %}
                                    <img class="comment__header__wrap__icon" src="{{ comment.user_image_url }}"
                                         alt="{{ comment.user_name }}">
                                {% else %}
                                    <img class="comment__header__wrap__icon" src="http://via.placeholder.com/48x48"
                                         alt="匿名ユーザー">
                                {% endif %}
                            </div>
                            <div class="comment__header__username">
                                {% if isSigned %}
                                    @{{ comment.user_name }}
                                {% else %}
                                    匿名ユーザー
                                {% endif %}
                            </div>
                        </div>
                        <div class="comment__header__createdat">
                            <a href="{{ path_for('comment', {'comment_id': comment.comment_id}) }}">{{ comment.createdAtStr }}</a>
                        </div>
                    </header>
                    <main class="comment__main" v-cloak>
                        <div id="{{ comment.comment_id }}" v-show="!editing"
                             v-html="comment_computed">
                        </div>
                        {% if comment.photo_url %}
                            <div class="comment_main__photo">
                                <img src="https://s3-{{ region }}.amazonaws.com/{{ bucket }}/{{ comment.photo_url }}"
                                     alt="{{ comment.comment }}">
                            </div>
                        {% endif %}
                    </main>
                    <footer class="comment__footer">
                        <div>
                            <a href="{{ path_for('thread', {}, {'thread_id': comment.thread_id}) }}">スレッドを見る</a>
                        </div>
                        <div>
                            そうだね&#215;<span
                                    id="like-{{ comment.comment_id }}_like">{{ comment.like_count }}</span>
                        </div>
                    </footer>
                </section>
            </article>
        </div>
    {% endif %}
{% endblock %}
{% block scripts %}
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script>
        const add_like_path = '' + '{{ path_for('add_like') }}';
        const update_path = '' + '{{ path_for('update_comment') }}';
    </script>
    <script src="{{ base_url() }}/assets/js/bundle.js"></script>
{% endblock %}