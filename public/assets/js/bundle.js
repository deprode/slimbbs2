!function(){return function t(e,n,r){function o(c,s){if(!n[c]){if(!e[c]){var u="function"==typeof require&&require;if(!s&&u)return u(c,!0);if(i)return i(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var a=n[c]={exports:{}};e[c][0].call(a.exports,function(t){return o(e[c][1][t]||t)},a,a.exports,t,e,n,r)}return n[c].exports}for(var i="function"==typeof require&&require,c=0;c<r.length;c++)o(r[c]);return o}}()({1:[function(t,e,n){"use strict";var r='<blockquote class="twitter-tweet"><a href="$url"></a></blockquote>',o='<a href="{url}" target="_new">{url}</a>',i=/^https?:\/\/twitter.com\/(.*)\/(status|statuses)\/(\d+)$/,c=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]\.[^\s]{2,})/,s=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._comment=n,this.id=e,this.user_id=n.user_id,this.comment_id=n.comment_id,this.comment=n.comment,this.pre_comment=n.comment,this.like_form_id="like-"+n.comment_id,this.count=n.like_count,this.edit=!1,this.unsent=!1,this.error_msg=""};function u(t){var e=t.split("\n");return(e=e.map(function(t){return i.test(t)?r.replace("$url",t):c.test(t)?o.replace(/{url}/g,t):t})).join("<br/>")}document.getElementById("top_comment").innerHTML=u(document.getElementById("top_comment").dataset.comment);var m=Object.keys(comments||[]).map(function(t,e){return new s(t,comments[t])}),a=m[m.length-1]&&m[m.length-1].comment_id||Number.MAX_SAFE_INTEGER;new Vue({delimiters:["${","}"],el:"#js-comments",data:{comments:m,error_msg:"",last_id:a,loading:!1},created:function(){0===this.comments.length&&this.fetchComment()},updated:function(){this.comments.map(function(t,e){twttr.widgets.load(document.getElementById("c"+t.comment_id))})},methods:{fetchComment:function(){var t=this;this.loading||(this.loading=!0,fetch(fetch_path+this.last_id,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(t){if(!t.ok)throw Error(t.statusText);return t.json()}).then(function(e){var n;t.error_msg="";var r=Object.keys(e).map(function(t,n){return new s(t,e[t])});(n=t.comments).push.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(r)),t.last_id=t.comments[t.comments.length-1].comment_id}).catch(function(e){t.error_msg="コメントを取得できませんでした。"}).finally(function(){t.loading=!1}))},isOwned:function(t){return t===user_id},editing:function(t){return t.edit},soudane:function(t){return"そうだね ×"+t.count},has_error:function(t){return""!==t.error_msg},comment_computed:u,editStart:function(t){t.edit=!0,t.pre_comment=t.comment},editCancel:function(t,e){e.preventDefault(),t.edit=!1,t.comment=t.pre_comment,t.error_msg=""},editEnd:function(t,e){e.preventDefault(),t.edit=!1,t.error_msg="";var n=document.getElementById(e.target.id).parentElement;fetch(update_path,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:new FormData(n)}).then(function(e){if(!e.ok)throw Error(e.statusText);t.error_msg=""}).catch(function(e){t.edit=!0,t.comment=t.pre_comment,t.error_msg="保存できませんでした。"}),t.pre_comment=t.comment},addLike:function(t){if(!t.unsent){var e=new FormData(document.getElementById(t.like_form_id));this.plus1(e,t),t.error_msg=""}},plus1:function(t,e){var n=this;fetch(add_like_path,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:t}).then(function(t){if(!t.ok)throw Error(t.statusText);n.updateCount(e),n.disabledButton(e)}).catch(function(t){e.error_msg="「そうだね」できませんでした。"})},updateCount:function(t){t.count=parseInt(t.count)+1},disabledButton:function(t){t.unsent=!0},deleteConfirm:function(t){!1===confirm("このコメントを削除しますか？")&&t.preventDefault()},scrolling:function(t){var e=document.body,n=document.documentElement,r=e.scrollTop||n.scrollTop;n.scrollHeight-r-n.clientHeight<=0&&!this.loading&&this.fetchComment()}},beforeMount:function(){window.addEventListener("scroll",this.scrolling)},afterMount:function(){window.removeEventListener("scroll",this.scrolling)}})},{}],2:[function(t,e,n){"use strict";var r,o,i,c,s,u;window.twttr=(r=document,o="script",i="twitter-wjs",s=r.getElementsByTagName(o)[0],u=window.twttr||{},r.getElementById(i)?u:((c=r.createElement(o)).id=i,c.src="https://platform.twitter.com/widgets.js",s.parentNode.insertBefore(c,s),u._e=[],u.ready=function(t){u._e.push(t)},u))},{}]},{},[2,1]);