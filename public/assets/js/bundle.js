"use strict";let comments=document.querySelectorAll("section.js-comment");Array.from(comments).forEach(t=>{const e=document.getElementById(t.id).dataset.comment,n=document.getElementById(t.id).querySelectorAll("form.js-like")[0],r='<blockquote class="twitter-tweet"><a href="$url"></a></blockquote>',o='<a href="{url}" target="_new">{url}</a>';new Vue({delimiters:["${","}"],el:"#"+t.id,data:{form_id:t.id,comment:e||"",edit:!1,pre_comment:e,like_form_id:n?n.id:"",count:n?document.getElementById(n.id).dataset.like:0,unsent:!1,error_msg:""},computed:{editing:function(){return this.edit},soudane:function(){return"そうだね ×"+this.count},has_error:function(){return""!==this.error_msg},comment_computed:function(){const t=/^https?:\/\/twitter.com\/(.*)\/(status|statuses)\/(\d+)$/,e=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]\.[^\s]{2,})/;let n=this.comment.split("\n");return(n=n.map(function(n){return t.test(n)?r.replace("$url",n):e.test(n)?o.replace(/{url}/g,n):n})).join("<br/>")}},methods:{editStart:function(){this.edit=!0,this.pre_comment=this.comment},editCancel:function(t){t.preventDefault(),this.edit=!1,this.comment=this.pre_comment,this.error_msg=""},editEnd:function(t){t.preventDefault(),this.edit=!1,this.error_msg="";const e=document.getElementById(t.target.id).parentElement;fetch(update_path,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:new FormData(e)}).then(t=>{if(!t.ok)throw Error(t.statusText);this.error_msg=""}).catch(t=>{this.edit=!0,this.comment=this.pre_comment,this.error_msg="保存できませんでした。"}),this.pre_comment=this.comment},addLike:function(t){if(this.unsent)return;const e=new FormData(document.getElementById(this.like_form_id));this.plus1(e),this.error_msg=""},plus1:function(t){const e=this;fetch(add_like_path,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:t}).then(function(t){if(!t.ok)throw Error(t.statusText);e.updateCount(),e.disabledButton()}).catch(t=>{this.error_msg="「そうだね」できませんでした。"})},updateCount:function(){this.count=parseInt(this.count)+1},disabledButton:function(){this.unsent=!0},deleteConfirm:function(t){!1===confirm("このコメントを削除しますか？")&&t.preventDefault()}}})});